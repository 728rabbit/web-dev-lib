class iwebApp{constructor(){this.current_language="en",this.language={en:{btn_confirm:"OK",btn_yes:"Yes",btn_no:"No",please_select:"Please Select",no_record_found:"No record found",type_error:"File type is not allowed.",max_error:"Maximum allowed file size {num}M.",required_all_error:"Please fill out all required fields correctly.",required_error:"Please fill out this field correctly.",password_error:"Password must contain at least 6 characters, including upper/lowercase and numbers (e.g. Abc123).",email_error:"Invalid email address format.",number_error:"Invalid number format.",date_error:"Invalid date format.",time_error:"Invalid time format.",ge0_error:"Value must be greater than or equal to 0.",gt0_error:"Value must be greater than 0."},zh_hant:{btn_confirm:"確定",btn_yes:"是",btn_no:"否",please_select:"請選擇",no_record_found:"找不到相關記錄",type_error:"不允許的檔案類型。",max_error:"檔案大小不能超過{num}M。",required_all_error:"請正確填寫所有必須欄位。",required_error:"請正確填寫此欄位。",password_error:"密碼必須至少包含6個字符，包括大寫/小寫和數字(例如Abc123)。",email_error:"無效的郵件地址格式。",number_error:"無效的數字格式。",date_error:"無效的日期格式。",time_error:"無效的時間格式。",ge0_error:"數值必須大於或等於 0。",gt0_error:"數值必須大於 0。"},zh_hans:{btn_confirm:"确定",btn_yes:"是",btn_no:"否",please_select:"请选择",no_record_found:"找不到相关记录",type_error:"不允许的档案类型。",max_error:"档案大小不能超过{num}M。",required_all_error:"请正确填写所有必须栏位。",required_error:"请正确填写此栏位。",password_error:"密码必须至少包含6个字符，包括大写/小写和数字(例如Abc123)。",email_error:"无效的邮件地址格式。",number_error:"无效的数字格式。",date_error:"无效的日期格式。",time_error:"无效的时间格式。",ge0_error:"数值必须大於或等於 0。",gt0_error:"数值必须大於 0。"}},this.imd5=new iMD5,this.csrf_token="",this.timer=null,this.scroll_timer=null,this.is_busy=!1,this.idatepicker=null,this.itimepicker=null,this.uploader_options={},this.uploader_files={},this.uploader_files_skip={},this.view_width=0,this.eventMap={}}init(){const i=this,a=(e,t)=>{"function"==typeof window[e]&&window[e](t)};document.addEventListener("DOMContentLoaded",function(){var e,t=document.documentElement.lang?.toLowerCase().replace("-","_"),t=(i.isValue(t)&&i.isValue(i.language[t])&&(i.current_language=t),document.querySelector('meta[name="csrf-token"]')?.content);i.isValue(t)&&(e=location.hostname||"/",i.csrf_token=i.imd5.hash(i.imd5.hash("iweb@"+e)+"@"+t)),i.initBody(),i.initComponent(),i.initForm(),i.view_width=parseInt(document.querySelector("div.iweb-viewer").offsetWidth),setTimeout(function(){console.log("DOM done"),document.body.style.setProperty("--iscrollbar-width",window.innerWidth-i.view_width+"px"),i.responsive(),a("iweb_common_layout",i.view_width),a("iweb_layout",i.view_width),a("iweb_chind_layout",i.view_width),a("iweb_extra_layout",i.view_width),a("iweb_common_func"),a("iweb_func"),a("iweb_child_func"),a("iweb_extra_func")},100)}),window.onload=function(){setTimeout(function(){console.log("window done"),a("iweb_common_layout_done",i.view_width),a("iweb_layout_done",i.view_width),a("iweb_child_layout_done",i.view_width),a("iweb_extra_layout_done",i.view_width),a("iweb_common_func_done"),a("iweb_func_done"),a("iweb_child_func"),a("iweb_extra_func_done")},100)},window.addEventListener("resize",function(){clearTimeout(i.timer),i.timer=setTimeout(()=>{console.log("window resize"),i.view_width!==parseInt(document.querySelector("div.iweb-viewer").offsetWidth)&&(i.view_width=parseInt(document.querySelector("div.iweb-viewer").offsetWidth),i.responsive(),a("iweb_common_layout",i.view_width),a("iweb_layout",i.view_width),a("iweb_child_layout",i.view_width),a("iweb_extra_layout",i.view_width))},200)}),window.addEventListener("scroll",function(){clearTimeout(i.scroll_timer),i.scroll_timer=setTimeout(()=>{console.log("window scroll"),a("iweb_common_scroll",window.scrollY),a("iweb_scroll",window.scrollY),a("iweb_child_scroll",window.scrollY),a("iweb_extra_scroll",window.scrollY)},100)})}initBody(){const o=this;document.body.classList.add("iweb");var e=Array.from(document.body.children).filter(function(e){return!["SCRIPT","NOSCRIPT","STYLE"].includes(e.tagName.toUpperCase())});if(0<e.length){const i=document.createElement("div");i.classList.add("iweb-viewer"),e.forEach(function(e){i.appendChild(e)}),document.body.prepend(i)}document.addEventListener("click",function(e){var i=e.target;if(i.closest("a")){var t=i.closest("a").getAttribute("href");if(!o.isValue(t)||o.isMatch(t,"#"))if(e.preventDefault(),i.closest("div.iweb-tips-message"))i.closest("div.iweb-tips-message").classList.remove("error"),i.closest("div.iweb-tips-message").classList.remove("success"),i.closest("div.iweb-tips-message").innerHTML="";else if(i.closest("a.fill-reset")){var t=i.closest("div.iweb-input-autocomplete").querySelector("input.fill-id"),e=i.closest("div.iweb-input-autocomplete").querySelector("input.fill-text"),a=i.closest("div.iweb-input-autocomplete").querySelector("a.fill-reset"),e=(t.value="",e.value="",e.readOnly=!1,a.remove(),t.getAttribute("data-rfunc"));"function"==typeof window[e]&&window[e](t)}else if(i.closest("a.font-switch")){const s=i.getAttribute("data-size");o.isValue(s)&&(o.setCookie("iweb_font_size",s),document.documentElement.classList.remove(...r),document.documentElement.classList.add(s+"-font"),d.forEach(function(e){e.classList.toggle("current",o.isMatch(e.getAttribute("data-size"),s))}))}else i.closest("a.control-stretch")&&i.closest("div.widget.expand")&&(i.closest("div.widget.expand").classList.contains("show")?i.closest("div.widget.expand").classList.remove("show"):i.closest("div.widget.expand").classList.add("show"))}if(i.closest("button.switch-pwd-type")&&(a=i.closest("div.iweb-input").querySelector("input"),e=i.closest("div.iweb-input").querySelector("i.show"),t=i.closest("div.iweb-input").querySelector("i.hide"),o.isMatch(a.type,"password")?(a.type="text",e.style.display="block",t.style.display="none"):(a.type="password",e.style.display="none",t.style.display="block")),i.closest("div.iweb-input-autocomplete")||document.querySelectorAll("div.iweb-input-autocomplete ul.fill-options").forEach(function(e){e.remove()}),i.closest("div.iweb-select")){const l=i.closest("div.iweb-select").querySelector("div.virtual > div.options > ul");if(o.isValue(l)){if(i.closest("a.result")&&(i.closest("div.iweb-select").classList.contains("show")?i.closest("div.iweb-select").classList.remove("show"):i.closest("div.iweb-select").classList.add("show")),document.querySelectorAll("div.iweb-select").forEach(function(e){var t=e.querySelector("div.virtual > div.options > ul");t&&!o.isMatch(t.getAttribute("data-index"),l.getAttribute("data-index"))&&e.classList.remove("show")}),i.closest("a")&&i.closest("li.node")){a=i.closest("div.iweb-select").classList.contains("iweb-select-multiple"),e=i.closest("div.iweb-select").querySelector("div.real > select");let t=[];if(a){e.querySelectorAll("option").forEach(function(e){0<e.children.length?Array.from(e.children).forEach(function(e){e.selected&&t.push(e.value.toString())}):e.selected&&t.push(e.value.toString())});const n=i.getAttribute("data-value").toString();t.includes(n)?t=t.filter(function(e){return e!==n}):t.push(n),e.querySelectorAll("option").forEach(function(e){t.includes(e.value.toString())?e.selected=!0:e.selected=!1})}else i.closest("div.iweb-select").classList.remove("show"),e.value=i.getAttribute("data-value");e.dispatchEvent(new Event("change",{bubbles:!0}))}}else document.querySelectorAll("div.iweb-select").forEach(function(e){e.classList.remove("show")})}else document.querySelectorAll("div.iweb-select").forEach(function(e){e.classList.remove("show")})}),document.addEventListener("input",function(e){const l=e.target;if(l.closest("div.iweb-input")&&(l.closest("div.iweb-input").classList.remove("error"),l.closest("div.iweb-input").querySelector("small.tips")?.remove()),l.closest("div.iweb-input-color"))o.isMatch(l.type,"color")?(e=l.closest("div.iweb-input-color").querySelector('input[type="text"]'),/^#[0-9A-F]{6}$/i.test(l.value)&&(e.value=l.value)):(e=l.closest("div.iweb-input-color").querySelector('input[type="color"]'),l.value.startsWith("#")||(l.value="#"+l.value),/^#[0-9A-F]{6}$/i.test(l.value)&&(e.value=l.value));else if(l.closest("div.iweb-input-autocomplete")&&l.closest("input.fill-text"))clearTimeout(o.timer),o.timer=setTimeout(()=>{l.closest("div.iweb-input-autocomplete").classList.remove("error"),l.closest("div.iweb-input-autocomplete").querySelector("small.tips")?.remove(),l.closest("div.iweb-input-autocomplete").querySelector("ul.fill-options")?.remove();var t={};for(let e=1;e<=5;e++){var i,a=l.closest("div.iweb-input-autocomplete").querySelector("input.fill-id").getAttribute("data-param"+e);o.isValue(a)&&([a,i]=a.split(":"),t[a]=i)}var e=l.value,s={dataType:"json",showBusy:!1,url:l.closest("div.iweb-input-autocomplete").querySelector("input.fill-id").getAttribute("data-url"),values:Object.assign({keywords:e},t)};o.isValue(e)&&o.ajaxPost(s,function(e){if(o.isValue(e)){e=Object.values(e);const a=document.createElement("ul");a.classList.add("fill-options"),e.forEach(function(e){var t=document.createElement("li"),i=document.createElement("a");i.setAttribute("data-id",e.id),i.setAttribute("data-value",o.isValue(e.value)?e.value:e.name),i.textContent=e.name,i.addEventListener("click",o.deBounce(function(e){var e=e.target,t=(e.closest("div.iweb-input-autocomplete").querySelector("a.fill-reset")?.remove(),e.closest("div.iweb-input-autocomplete").querySelector("input.fill-id")),i=e.closest("div.iweb-input-autocomplete").querySelector("input.fill-text"),e=(t.value=e.getAttribute("data-id"),i.value=e.getAttribute("data-value"),i.readOnly=!0,document.createElement("a")),i=(e.classList.add("fill-reset"),document.createElement("i")),i=(i.classList.add("fa","fa-times"),i.style.color="#d73d32",e.appendChild(i),t.closest("div.iweb-input-autocomplete").appendChild(e),t.closest("div.iweb-input-autocomplete").classList.remove("error"),t.closest("div.iweb-input-autocomplete").querySelector("small.tips")?.remove(),t.closest("div.iweb-input-autocomplete").querySelector("ul.fill-options")?.remove(),t.getAttribute("data-sfunc"));"function"==typeof window[i]&&window[i](t.value,t)})),t.appendChild(i),a.appendChild(t)}),l.closest("div.iweb-input-autocomplete").appendChild(a)}else{var e=document.createElement("ul"),t=(e.classList.add("fill-options"),document.createElement("li"));t.classList.add("empty"),t.textContent=o.language[o.current_language].no_record_found,e.appendChild(t),l.closest("div.iweb-input-autocomplete").appendChild(e)}})},1e3);else if(l.closest("div.iweb-select")&&l.closest("li.filter")){const i=l.value;o.isValue(i)?l.closest("div.iweb-select").querySelectorAll("div.virtual > div.options ul > li.node > a").forEach(function(e){var t;-1<(e.textContent||e.innerText).toLowerCase().indexOf(i.toLowerCase())?(e.parentElement.classList.remove("hide"),(t=e.closest("li.node-parent"))&&t.classList.remove("hide")):e.parentElement.classList.add("hide")}):l.closest("div.iweb-select").querySelectorAll("div.virtual > div.options ul > li.node").forEach(function(e){e.classList.remove("hide")})}}),document.addEventListener("change",function(e){e=e.target;if(e.closest("div.iweb-select")){let i=[],a="";e.closest("div.iweb-select").classList.remove("error"),e.closest("div.iweb-select").querySelector("small.tips")?.remove(),Array.from(e.querySelectorAll("option")).forEach(function(e){0<e.children.length?Array.from(e.children).forEach(function(e){e.selected&&i.push(e.value.toString())}):e.selected&&i.push(e.value.toString())}),0<e.closest("div.iweb-select").querySelectorAll("div.virtual > div.options ul > li > a").length&&(e.closest("div.iweb-select").querySelectorAll("div.virtual > div.options ul > li > a").forEach(function(e){var t=e.getAttribute("data-value");o.isValue(t)&&(o.isMatch(i.indexOf(t),-1)?e.parentElement.classList.remove("node-selected"):(e.parentElement.classList.add("node-selected"),o.isValue(a)&&(a+=", "),a+=e.textContent))}),o.isValue(a)||(a=o.isValue(e.getAttribute("data-default"))?e.getAttribute("data-default"):o.language[o.current_language].please_select),e.closest("div.iweb-select").querySelector("div.virtual > a.result").innerHTML=a)}else if(e.closest("div.iweb-checkbox"))document.querySelectorAll('input[type="checkbox"][name="'+e.name+'"]').forEach(function(e){e.closest("div.iweb-checkbox").classList.remove("checked"),e.checked&&e.closest("div.iweb-checkbox").classList.add("checked"),e.closest("div.iweb-checkbox").classList.remove("error")}),e.closest("div.iweb-checkbox-set")&&e.closest("div.iweb-checkbox-set").querySelector("small.tips")?.remove();else if(e.closest("div.iweb-radio")){const t=e.value;document.querySelectorAll('input[type="radio"][name="'+e.name+'"]').forEach(function(e){o.isMatch(e.value,t)?(e.checked=!0,e.closest("div.iweb-radio").classList.add("checked")):(e.checked=!1,e.closest("div.iweb-radio").classList.remove("checked")),e.closest("div.iweb-radio").classList.remove("error")}),e.closest("div.iweb-radio-set")&&e.closest("div.iweb-radio-set").querySelector("small.tips")?.remove()}});const r=["small-font","middle-font","large-font"],t=o.getCookie("iweb_font_size"),d=document.querySelectorAll("a.font-switch");o.isValue(t)&&(document.documentElement.classList.remove(...r),document.documentElement.classList.add(t+"-font"),d.forEach(function(e){e.classList.toggle("current",o.isMatch(e.getAttribute("data-size"),t))}))}initComponent(){var e=this;e.inputBox(),e.selectBox(),e.checkBox(),e.radioBox(),e.iframe(),document.querySelectorAll("div.iweb-editor").forEach(e=>{var t=document.createElement("div"),t=(t.className="clearboth",e.insertAdjacentElement("afterbegin",t),document.createElement("div"));t.className="clearboth",e.insertAdjacentElement("beforeend",t)})}inputBox(e,t){const n=this;0<(e=n.isValue(e)?e:document.querySelectorAll(['input[type="text"]','input[type="password"]','input[type="date"]','input[type="time"]','input[type="color"]','input[type="tel"]','input[type="email"]','input[type="number"]','input[type="file"]',"textarea"].join(", "))).length&&e.forEach(function(e){var t,i,a,s,l;e.closest("div.iweb-input")||(t=e.type,s=n.isMatch(e.getAttribute("data-autocomplete"),1)||n.isMatch(e.getAttribute("data-autocomplete"),!0),(i=document.createElement("div")).classList.add("iweb-input"),i.classList.add(s?"iweb-input-autocomplete":"iweb-input-"+(n.isValue(e.type)?e.type:"text")),e.parentNode.insertBefore(i,e),i.appendChild(e),s?(s=n.isValue(e.getAttribute("data-validation"))?e.getAttribute("data-validation").toString().split("|"):[],l=!!n.isMatch(e.getAttribute("data-cannew"),1),(a=document.createElement("input")).type="text",l&&(a.name=e.name.toString().replace(/(\w+)(\[\])?$/,"$1_txt$2"),s.includes("required"))&&a.setAttribute("data-validation","required"),a.placeholder=e.getAttribute("data-placeholder")||"",a.classList.add("fill-text"),a.style.display="block",a.style.width="100%",a.autocomplete="off",i.appendChild(a),l=e.getAttribute("data-default"),e.removeAttribute("data-default"),n.isValue(l)&&(a.setAttribute("data-value",e.value),a.setAttribute("data-default",l),a.setAttribute("value",l),a.readOnly=!0,(s=document.createElement("a")).classList.add("fill-reset"),(l=document.createElement("i")).classList.add("fa","fa-times"),l.style.color="#d73d32",s.appendChild(l),i.appendChild(s)),e.type="hidden",e.classList.add("fill-id"),e.removeAttribute("data-validation"),e.removeAttribute("data-cannew"),e.removeAttribute("data-autocomplete")):n.isMatch(t,"password")?((a=document.createElement("button")).type="button",a.classList.add("switch-pwd-type"),(l=document.createElement("i")).classList.add("fa","fa-eye-slash","hide"),l.style.display="block",(s=document.createElement("i")).classList.add("fa","fa-eye","show"),s.style.display="none",a.appendChild(l),a.appendChild(s),i.appendChild(a)):n.isMatch(t,"color")&&(e.style.position="relative",e.style.zIndex=1,(l=document.createElement("input")).type="text",l.maxLength=7,l.value=e.value,l.style.position="absolute",l.style.top="0px",l.style.left="0px",l.style.right="0px",l.style.bottom="0px",l.style.paddingLeft="42px",i.appendChild(l)),e.style.display=n.isMatch(t,"color")?"inline-block":"block",e.style.width=n.isMatch(t,"color")?"36px":"100%",e.autocomplete="off")}),n.isValue(n.idatepicker)||(n.idatepicker=new iDatePicker(n.current_language)),n.idatepicker.render('input[type="date"]'),n.isValue(n.itimepicker)||(n.itimepicker=new iTimePicker),n.itimepicker.render('input[type="time"]'),"function"==typeof t&&t()}selectBox(e,t){const u=this;0<(e=u.isValue(e)?e:document.querySelectorAll("select")).length&&e.forEach(function(e,t){if(!e.closest("div.iweb-select")){var i=!(!u.isMatch(e.multiple,1)&&!u.isMatch(e.multiple,!0)),a=!(!u.isMatch(e.getAttribute("data-virtual"),1)&&!u.isMatch(e.getAttribute("data-virtual"),!0)),l=!(!u.isMatch(e.getAttribute("data-filter"),1)&&!u.isMatch(e.getAttribute("data-filter"),!0)),n=!(!u.isMatch(e.getAttribute("data-top"),1)&&!u.isMatch(e.getAttribute("data-top"),!0));if(a){a=document.createElement("div"),i=(a.classList.add("iweb-select"),i&&a.classList.add("iweb-select-multiple"),document.createElement("div"));i.classList.add("real","hidden"),e.parentNode.insertBefore(i,e),i.appendChild(e),i.parentNode.insertBefore(a,i),a.appendChild(i);let s="";var o,i=document.createElement("div"),r=(i.classList.add("virtual"),document.createElement("a")),d=(r.classList.add("result"),r.textContent=s,i.appendChild(r),document.createElement("div"));d.classList.add("options"),n&&d.classList.add("top");const c=document.createElement("ul");c.setAttribute("data-index","iss"+t),l&&((n=document.createElement("li")).classList.add("filter"),l=e.getAttribute("data-placeholder")||"",(o=document.createElement("input")).id="fkw_"+t,o.type="text",o.placeholder=l.trim(),n.appendChild(o),c.appendChild(n)),0<e.children.length&&Array.from(e.children).forEach(function(e){if(0<e.children.length){var t=document.createElement("li"),i=(t.classList.add("node","node-parent"),document.createElement("a"));i.textContent=e.getAttribute("label"),t.appendChild(i);const a=document.createElement("ul");Array.from(e.children).forEach(function(e){var t,i;u.isValue(e.value)&&((t=document.createElement("li")).classList.add("node"),e.selected&&(t.classList.add("node-selected"),t.setAttribute("data-ori","selected"),s=(s+=s?", ":"")+e.textContent),(i=document.createElement("a")).setAttribute("data-value",e.value),i.textContent=e.textContent,t.appendChild(i),a.appendChild(t))}),t.appendChild(a),c.appendChild(t)}else{i=document.createElement("li"),t=(i.classList.add("node"),document.createElement("a"));t.setAttribute("data-value",e.value),t.textContent=e.textContent,e.selected&&(i.classList.add("node-selected"),i.setAttribute("data-ori","selected"),s=(s+=s?", ":"")+e.textContent),i.appendChild(t),c.appendChild(i)}}),u.isValue(s)||(s=u.isValue(e.getAttribute("data-default"))?e.getAttribute("data-default"):u.language[u.current_language].please_select),r.textContent=s,d.appendChild(c),i.appendChild(d),a.appendChild(i)}else{t=document.createElement("div"),l=(t.classList.add("iweb-select"),document.createElement("div"));l.classList.add("real"),e.parentNode.insertBefore(l,e),l.appendChild(e),l.parentNode.insertBefore(t,l),t.appendChild(l)}e.removeAttribute("data-virtual"),e.removeAttribute("data-filter")}}),"function"==typeof t&&t()}checkBox(e,t){const a=this;0<(e=a.isValue(e)?e:document.querySelectorAll('input[type="checkbox"]')).length&&e.forEach(function(e){var t,i;e.closest("div.iweb-checkbox")||(t=e.nextElementSibling,(i=document.createElement("div")).classList.add("iweb-checkbox"),e.checked&&i.classList.add("checked"),e.parentNode.insertBefore(i,e),i.appendChild(e),t&&a.isMatch(t.tagName,"label")&&(t.parentNode.insertBefore(i,t),i.appendChild(t)))}),"function"==typeof t&&t()}radioBox(e,t){const a=this;0<(e=a.isValue(e)?e:document.querySelectorAll('input[type="radio"]')).length&&e.forEach(function(e){var t,i;e.closest("div.iweb-radio")||(t=e.nextElementSibling,(i=document.createElement("div")).classList.add("iweb-radio"),e.checked&&i.classList.add("checked"),e.parentNode.insertBefore(i,e),i.appendChild(e),t&&a.isMatch(t.tagName,"label")&&(t.parentNode.insertBefore(i,t),i.appendChild(t)))}),"function"==typeof t&&t()}iframe(t="div.iweb-editor",e){this.isValue(t)&&(["iframe","video","object","embed"].forEach(function(e){document.querySelectorAll(t+" "+e).forEach(function(e){var t;e.closest("div.iweb-responsive")||((t=document.createElement("div")).className="iweb-responsive",t.setAttribute("data-width",e.offsetWidth),t.setAttribute("data-height",e.offsetHeight),e.classList.add("vframe"),e.parentNode.insertBefore(t,e),t.appendChild(e))})}),"function"==typeof e)&&e()}responsive(){const l=this;var e=document.querySelectorAll("div.iweb-responsive");0<e.length&&e.forEach(function(e){var t=e.clientWidth;let i=0;var a=e.getAttribute("data-width"),s=e.getAttribute("data-height");0<(i=l.isValue(a)&&l.isValue(s)&&0<s&&0<a?parseInt(t*s/a):i)?e.style.height=i+"px":e.style.height="auto"})}pagination(e){document.querySelectorAll(e).forEach(function(e){new iPagination(e,{mode:e.getAttribute("data-mode")||1,size:e.getAttribute("data-size")||5,total:e.getAttribute("data-totalpage")||1,placeholder:e.getAttribute("data-placeholder")||""})})}ajaxPost(t,i,e,a){const s=this;if((t=Object.assign({dataType:"json",showBusy:!0,url:"",values:{}},t)).showBusy||(s.is_busy=!1),!s.is_busy&&s.isValue(t.url)){var l=s.toDateTime(),n=new FormData;if(n.append("itoken",window.btoa(s.imd5.hash(s.csrf_token+"#dt"+l)+"%"+l)),t.values)for(var o in t.values)if(t.values.hasOwnProperty(o)){var r=t.values[o];if("object"!=typeof r||(r instanceof File||r instanceof FileList))n.append(o,r);else for(var d in r)n.append(o+"["+d+"]",r[d])}const c=()=>{s.is_busy=!1,s.isMatch(t.showBusy,2)||s.showBusy(!1),"function"==typeof e&&e()};try{s.is_busy=!0,s.showBusy(!0,t.showBusy?50:0);const u=new XMLHttpRequest;u.open("POST",t.url,!0),u.upload.onprogress=function(e){e.lengthComputable&&(e=Math.ceil(e.loaded/e.total*100),"function"==typeof a)&&a(e)},u.onload=function(){if(c(),!(200<=u.status&&u.status<300))throw new Error(u.statusText);{let e;switch(t.dataType.toLowerCase()){case"json":e=JSON.parse(u.responseText);break;case"blob":e=u.response;break;default:e=u.responseText}"function"==typeof i&&i(e)}},u.onerror=function(){c(),alert("Unstable network, please check your network connection.")},u.onabort=function(){c(),alert("Request aborted.")},u.ontimeout=function(){c(),alert("Request timed out.")},u.send(n)}catch(e){c();let t=e.message;return e.message.includes("NetworkError")?t="Unstable network, please check your network connection.":e.message.includes("404")?t="The requested page not found.":e.message.includes("500")&&(t="Internal Server Error."),alert(t),!1}}}initForm(e){const o=this;0<(e=o.isValue(e)?e:document.querySelectorAll('form[data-ajax="1"]')).length&&e.forEach(function(a){const l=!o.isMatch(a.getAttribute("data-showtips"),!1)&&!o.isMatch(a.getAttribute("data-showtips"),0),i=!o.isValue(a.getAttribute("data-busy"))||a.getAttribute("data-busy"),n=!!o.isValue(a.getAttribute("data-alert"));a.removeAttribute("data-ajax"),a.removeAttribute("data-showtips"),a.removeAttribute("data-busy"),a.removeAttribute("data-alert"),a.method="post",a.autocomplete="off",a.addEventListener("submit",o.deBounce(function(){a.querySelectorAll(".error").forEach(function(e){e.closest("div.iweb-tips-message")||e.classList.remove("error")}),a.querySelectorAll("small.tips").forEach(function(e){e.remove()});let s=!0;var e,t=a.querySelectorAll("input[data-validation]:not(:disabled), select[data-validation]:not(:disabled), textarea[data-validation]:not(:disabled)"),t=(0<t.length&&t.forEach(function(t){var i,a=t.getAttribute("data-validation").toString().split("|");if(o.isMatch(t.type,"checkbox"))a.includes("required")&&t.closest("div.iweb-checkbox-set")&&!t.closest("div.iweb-checkbox-set").querySelector('input[type="checkbox"]:checked')&&(l&&!t.closest("div.iweb-checkbox-set").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].required_error,t.closest("div.iweb-checkbox-set").appendChild(i)),t.closest("div.iweb-checkbox").classList.add("error"),s=!1);else if(o.isMatch(t.type,"radio"))a.includes("required")&&t.closest("div.iweb-radio-set")&&!t.closest("div.iweb-radio-set").querySelector('input[type="radio"]:checked')&&(l&&!t.closest("div.iweb-radio-set").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].required_error,t.closest("div.iweb-radio-set").appendChild(i)),t.closest("div.iweb-radio").classList.add("error"),s=!1);else if(o.isMatch(t.type,"select-one")||o.isMatch(t.type,"select-multiple"))a.includes("required")&&!o.isValue(t.value)&&(l&&!t.closest("div.iweb-select").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].required_error,t.closest("div.iweb-select").appendChild(i)),t.closest("div.iweb-select").classList.add("error"),s=!1);else if(a.includes("required")&&!o.isValue(t.value))l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].required_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1;else if(o.isValue(t.value)){let e=!0;a.includes("number")&&!o.isNumber(t.value)?(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].number_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("email")&&!o.isEmail(t.value)?(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].email_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("password")&&!o.isPassword(t.value)?(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].password_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("date")&&!o.isDate(t.value)?(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].date_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("time")&&!o.isTime(t.value)?(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].time_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("ge0")?o.isNumber(t.value)?/^(?:0|[1-9]\d*)(?:\.\d+)?$/.test(t.value)||(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].ge0_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].number_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):a.includes("gt0")&&(o.isNumber(t.value)?parseFloat(t.value)<=0&&(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].gt0_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1):(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&((i=document.createElement("small")).classList.add("tips"),i.textContent=o.language[o.current_language].number_error,t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1,e=!1)),e&&a.includes("regex")&&(i=new RegExp(t.getAttribute("data-regex")),a=t.getAttribute("data-error"),i.test(t.value.toString().toLowerCase())||(l&&!t.closest("div.iweb-input").querySelector("small.tips")&&o.isValue(a)&&((i=document.createElement("small")).classList.add("tips"),i.textContent=a.toString(),t.closest("div.iweb-input").appendChild(i)),t.closest("div.iweb-input").classList.add("error"),s=!1))}}),a.getAttribute("data-vfunc"));if("function"==typeof window[t]&&(e=window[t](s),s=s&&e),s){let s={dataType:"json",showBusy:i,url:a.action,values:{}};new FormData(a).forEach(function(t,e){var i=e.match(/(.*)((\[)(.*)(\]))$/i);if(i){var a=i[1];let e=i[4];s.values[a]||(s.values[a]={}),o.isValue(e)||(e=Object.keys(s.values[a]).length+1),s.values[a][e]=t}else s.values[e]=t}),o.ajaxPost(s,function(e){var t=a.getAttribute("data-cfunc"),i=a.getAttribute("data-efunc");"function"==typeof window[t]?window[t](e):(o.isValue(e.status)&&o.isMatch(e.status,200)?o.isValue(e.url)?o.isMatch(n,!0)||o.isMatch(n,1)?o.alert(e.message,function(){o.isMatch(e.url,"#")?window.location.reload():window.location.href=e.url}):o.isMatch(e.url,"#")?window.location.reload():window.location.href=e.url:o.tipsMsg(e.message,!0):o.tipsMsg(e.message,!1),"function"==typeof window[i]&&window[i](e))})}else"function"!=typeof window[t]&&o.tipsMsg(o.language[o.current_language].required_all_error,!1,function(){document.querySelector("div.iweb-tips-message")||o.scrollTo(".error")})})),a.addEventListener("reset",o.deBounce(function(){var e=a.querySelectorAll("input, select, textarea");0<e.length&&e.forEach(function(e){var t,i;o.isMatch(e.type,"checkbox")||o.isMatch(e.type,"radio")||o.isMatch(e.type,"select-one")||o.isMatch(e.type,"select-multiple")?e.dispatchEvent(new Event("change",{bubbles:!0})):e.closest("div.iweb-input-autocomplete")?(e.closest("div.iweb-input-autocomplete").classList.remove("error"),e.closest("div.iweb-input-autocomplete").querySelector("small.tips")?.remove(),t=e.closest("div.iweb-input-autocomplete").querySelector("input.fill-id"),i=e.closest("div.iweb-input-autocomplete").querySelector("input.fill-text"),e.closest("div.iweb-input-autocomplete").querySelector("a.fill-reset")?.remove(),o.isValue(i.getAttribute("data-value"))&&o.isValue(i.getAttribute("data-default"))&&(t.value=i.getAttribute("data-value"),i.value=i.getAttribute("data-default"),i.readOnly=!1,(t=document.createElement("a")).classList.add("fill-reset"),(i=document.createElement("i")).classList.add("fa"),i.classList.add("fa-times"),i.style.color="#d73d32",t.appendChild(i),e.closest("div.iweb-input-autocomplete").appendChild(t))):e.dispatchEvent(new Event("input",{bubbles:!0}))})},100,!1))})}uploader(s,l){const n=this;var e=document.createElement("input");e.type="file",e.multiple=!0,e.addEventListener("change",n.deBounce(function(e){var t,i;e.target;let a=this.files;7<a.length&&(a=Array.from(a).slice(0,7)),n.uploader_files.selected_files=a,n.uploader_files_skip.selected_files=[-1],n.uploader_options.selected_files={dataType:"json",url:"",values:{},allowed_types:"",max_filesize:64,type_error_message:n.language[n.current_language].type_error,max_error_message:n.language[n.current_language].max_error,btnStartAll:'<i class="fa fa-cloud-upload"></i>',btnClose:'<i class="fa fa-close"></i>',btnStart:'<i class="fa fa-cloud-upload"></i>',btnRemove:'<i class="fa fa-trash"></i>',auto_close:!1},n.isValue(s)&&Object.assign(n.uploader_options.selected_files,s),n.isValue(n.uploader_options.selected_files.allowed_types)&&(n.uploader_options.selected_files.allowed_types=n.uploader_options.selected_files.allowed_types.split("|")),n.uploader_options.selected_files.max_error_message=n.uploader_options.selected_files.max_error_message.replace("{num}",n.uploader_options.selected_files.max_filesize),n.isValue(n.uploader_options.selected_files.url)&&0<n.uploader_files.selected_files.length&&((e=document.createElement("div")).classList.add("action"),(t=document.createElement("button")).type="button",t.classList.add("start-all"),t.innerHTML=n.uploader_options.selected_files.btnStartAll,(i=document.createElement("button")).type="button",i.classList.add("close"),i.innerHTML=n.uploader_options.selected_files.btnClose,e.appendChild(t),e.appendChild(i),(t=document.createElement("div")).classList.add("list"),(i=document.createElement("div")).appendChild(e),i.appendChild(t),n.dialog(i.innerHTML,function(){n.uploaderPreview(n.uploader_files.selected_files);var e=document.querySelector("div.iweb-info-dialog.uploader > div > div.content > div > div.action > button.start-all"),t=document.querySelector("div.iweb-info-dialog.uploader > div > div.content > div > div.action > button.close");const i=document.querySelector("div.iweb-info-dialog.uploader > div > div.content > div > div.list");e.addEventListener("click",n.deBounce(function(){var e=i.querySelectorAll("div.item");let t=[];e.forEach(function(e){t.push(e.getAttribute("data-index").toString())}),n.uploaderStart(-1,t,t[t.length-1])})),t.addEventListener("click",n.deBounce(function(){document.querySelector("div.iweb-info-dialog.uploader > div > div.content > a.btn-close").dispatchEvent(new Event("click",{bubbles:!0}))})),i.querySelectorAll("div.item > button.start").forEach(function(e){e.addEventListener("click",n.deBounce(function(e){e=e.target;n.uploaderStart(e.closest("div.item").getAttribute("data-index"))}))}),i.querySelectorAll("div.item > button.remove").forEach(function(e){e.addEventListener("click",n.deBounce(function(e){e=e.target;n.uploader_files_skip.selected_files.push(e.closest("div.item").getAttribute("data-index").toString()),e.closest("div.item").remove(),0===i.querySelectorAll("div.item").length&&document.querySelector("div.iweb-info-dialog.uploader > div > div.content > a.btn-close").dispatchEvent(new Event("click",{bubbles:!0}))}))})},function(){"function"==typeof l&&l()},"uploader"))})),e.click()}uploaderArea(o,r,d){const c=this;var e=document.getElementById(o),e=(e.removeAttribute("name"),e.multiple=!0,e.addEventListener("change",c.deBounce(function(e){const t=this;e=e.target;let i=t.files;if(7<i.length&&(i=Array.from(i).slice(0,7)),c.uploader_files["inline_selected_files_"+c.imd5.hash(o)]=i,c.uploader_files_skip["inline_selected_files_"+c.imd5.hash(o)]=[-1],c.uploader_options["inline_selected_files_"+c.imd5.hash(o)]={dataType:"json",url:"",values:{},allowed_types:"",max_filesize:64,type_error_message:c.language[c.current_language].type_error,max_error_message:c.language[c.current_language].max_error,btnStartAll:'<i class="fa fa-cloud-upload"></i>',btnClose:'<i class="fa fa-close"></i>',btnStart:'<i class="fa fa-cloud-upload"></i>',btnRemove:'<i class="fa fa-trash"></i>',auto_close:!1},c.isValue(r)&&(c.uploader_options["inline_selected_files_"+c.imd5.hash(o)]=Object.assign(c.uploader_options["inline_selected_files_"+c.imd5.hash(o)],r)),c.isValue(c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].allowed_types)&&(c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].allowed_types=c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].allowed_types.split("|")),c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].max_error_message=c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].max_error_message.replace("{num}",c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].max_filesize),c.isValue(c.uploader_options["inline_selected_files_"+c.imd5.hash(o)].url)&&0<t.files.length){const l=e.closest("div.iweb-files-dropzone").querySelector("div.iweb-files-uploader");var e=document.createElement("div"),a=(e.className="action",document.createElement("button")),s=(a.className="start-all",a.type="button",a.title="Start All",a.innerHTML='<i class="fa fa-cloud-upload"></i>',document.createElement("button"));s.className="close",s.type="button",s.innerHTML='<i class="fa fa-close"></i>';const n=document.createElement("div");n.classList.add("list"),e.appendChild(a),e.appendChild(s),l.appendChild(e),l.appendChild(n),c.uploaderPreview(c.uploader_files["inline_selected_files_"+c.imd5.hash(o)],0,o),a.addEventListener("click",c.deBounce(function(){var e=n.querySelectorAll("div.item");let t=[];e.forEach(function(e){t.push(e.getAttribute("data-index").toString())}),c.uploaderStart(-1,t,t[t.length-1],o)})),s.addEventListener("click",c.deBounce(function(){l.innerHTML="",t.value="","function"==typeof d&&d()})),n.querySelectorAll("div.item > button.start").forEach(function(e){e.addEventListener("click",c.deBounce(function(e){e=e.target;c.uploaderStart(e.closest("div.item").getAttribute("data-index"),null,null,o)}))}),n.querySelectorAll("div.item > button.remove").forEach(function(e){e.addEventListener("click",c.deBounce(function(e){e=e.target;c.uploader_files_skip["inline_selected_files_"+c.imd5.hash(o)].push(e.closest("div.item").getAttribute("data-index").toString()),e.closest("div.item").remove(),0===n.querySelectorAll("div.item").length&&(l.innerHTML="",t.value="")}))})}})),e.parentElement),t=(e.id=o+"-iweb-files-dropzone",e.classList.add("iweb-files-dropzone"),document.createElement("div"));t.className="iweb-files-uploader",e.appendChild(t)}uploaderPreview(t,i=0,a){var s=this;if(!(i>=t.length)){var l=t[i],n=l.name.split(".").pop().toLowerCase();let e=!0;var o=document.createElement("div");o.classList.add("item"),o.setAttribute("data-index",i);const p=document.createElement("div"),h=(p.classList.add("photo"),document.createElement("img"));/^(.*)(.jpg|.jpeg|.gif|.png|.bmp)$/.test(l.name.toLowerCase())&&"undefined"!=typeof FileReader?((r=new FileReader).onload=function(e){h.src=e.target.result,p.appendChild(h)},r.readAsDataURL(l)):p.innerHTML={pdf:'<i class="fa fa-file-pdf-o" style="color:#ef4130;"></i>',doc:'<i class="fa fa-file-word-o" style="color:#5091cd;"></i>',docx:'<i class="fa fa-file-word-o" style="color:#5091cd;"></i>',xls:'<i class="fa fa-file-excel-o" style="color:#66cdaa;"></i>',xlsx:'<i class="fa fa-file-excel-o" style="color:#66cdaa;"></i>',ppt:'<i class="fa fa-file-powerpoint-o" style="color:#f7b002;"></i>',pptx:'<i class="fa fa-file-powerpoint-o" style="color:#f7b002;"></i>',txt:'<i class="fa fa-file-text-o"></i>',avi:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',mov:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',mp4:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',ogg:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',wmv:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',webm:'<i class="fa fa-file-video-o" style="color:#5091cd;"></i>',mp3:'<i class="fa fa-file-audio-o" style="color:#66cdaa;"></i>',wav:'<i class="fa fa-file-audio-o" style="color:#66cdaa;"></i>',rar:'<i class="fa fa-file-zip-o" style="color:#f7b002;"></i>',zip:'<i class="fa fa-file-zip-o" style="color:#f7b002;"></i>'}[n]||'<i class="fa fa-file-code-o"></i>',o.appendChild(p);var r=document.createElement("div"),d=(r.classList.add("info"),document.createElement("div")),d=(d.classList.add("title"),d.textContent=l.name,r.appendChild(d),document.createElement("div")),d=(d.classList.add("size"),d.textContent=s.formatBytes(l.size,0),r.appendChild(d),s.isValue(a)?"inline_selected_files_"+s.imd5.hash(a):"selected_files"),d=s.uploader_options[d],c=d.allowed_types||[],u=1024*d.max_filesize*1024,u=(c.length&&c.indexOf(n)<0?((c=document.createElement("div")).classList.add("tips"),c.innerHTML="<small>"+d.type_error_message+"</small>",r.appendChild(c),e=!1):l.size>u?((n=document.createElement("div")).classList.add("tips"),n.innerHTML="<small>"+d.max_error_message+"</small>",r.appendChild(n),e=!1):((c=document.createElement("div")).classList.add("progress-bar"),c.innerHTML='<div class="percent"></div>',r.appendChild(c)),o.appendChild(r),e&&((l=document.createElement("button")).type="button",l.classList.add("start"),l.innerHTML='<i class="fa fa-cloud-upload"></i>',o.appendChild(l)),document.createElement("button")),d=(u.type="button",u.classList.add("remove"),u.innerHTML='<i class="fa fa-trash"></i>',o.appendChild(u),s.isValue(a)?"#"+a+"-iweb-files-dropzone > div.iweb-files-uploader > div.list":"div.iweb-info-dialog.uploader > div > div.content > div > div.list");document.querySelector(d).appendChild(o),s.uploaderPreview(t,i+1,a)}}uploaderStart(a,s,l,n){const o=this;let r="selected_files";o.isValue(n)&&(r="inline_selected_files_"+o.imd5.hash(n));const d=()=>{var e,t=o.isValue(n)?document.querySelector("#"+n+"-iweb-files-dropzone"):document.querySelector("div.iweb-info-dialog.uploader");t&&(e=t.querySelectorAll("div.list > div.item > button.start").length,0===parseInt(e)&&(t.querySelector("div.action > button.start-all")?.remove(),o.uploader_options[r].auto_close)&&t.querySelector("div.action > button.close").dispatchEvent(new Event("click",{bubbles:!0})),t.classList.remove("busy"))},c=o.isValue(n)?document.querySelector("#"+n+"-iweb-files-dropzone"):document.querySelector("div.iweb-info-dialog.uploader");c.classList.add("busy");let u=!0;if(o.isValue(s)?a+=1:(s=[a],l=a,u=!1),parseInt(a)<=parseInt(l))if(s.includes(a.toString()))if(o.isValue(o.uploader_files[r])&&!o.uploader_files_skip[r].includes(a.toString())){o.uploader_files_skip[r].push(a.toString());var t=o.uploader_files[r],i=t[a].name.split(".").pop().toLowerCase();let e=!0;if(e=o.isValue(o.uploader_options[r].allowed_types)&&!o.uploader_options[r].allowed_types.includes(i.toString())||t[a].size>1024*o.uploader_options[r].max_filesize*1024?!1:e){let i={dataType:"json",showBusy:!1,url:o.uploader_options[r].url,values:{}};var p=new FormData;if(p.append("page_action","file_upload"),o.isValue(o.uploader_options[r].values)){var h,m=o.uploader_options[r].values;for(h in m)m.hasOwnProperty(h)&&p.append(h,m[h])}p.append("myfile",t[a],t[a].name),p.forEach(function(e,t){i.values[t]=e}),o.ajaxPost(i,function(e){var t=c.querySelector('div.list > div.item[data-index="'+a+'"]'),e=(t.querySelector("div.info > div.progress-bar")?.remove(),e.message||e),t=t.querySelector("div.info"),i=document.createElement("div");i.classList.add("tips"),i.innerHTML="<small>"+e+"</small>",t.appendChild(i),u?o.uploaderStart(a,s,l,n):d()},null,function(e){var t=c.querySelector('div.list > div.item[data-index="'+a+'"]'),t=(t.querySelector("button.start")?.remove(),t.querySelector("button.remove")?.remove(),t.querySelector("div.info > div.progress-bar > div.percent"));t&&(t.style.width=e+"%")})}else{i=c.querySelector('div.list > div.item[data-index="'+a+'"]');i.querySelector("button.start")?.remove(),i.querySelector("button.remove")?.remove(),u?o.uploaderStart(a,s,l,n):d()}}else u?o.uploaderStart(a,s,l,n):d();else u?o.uploaderStart(a,s,l,n):d();else d()}alert(e,i,t){if(!(0<document.querySelectorAll("div.iweb-alert-dialog").length)){const n=this;if(n.isValue(e)){var a=document.createElement("div"),t=(a.classList.add("iweb-alert-dialog"),n.isValue(t)&&a.classList.add(t),document.createElement("div"));const o=document.createElement("div");o.classList.add("content"),o.style.transition="transform 0.5s ease, opacity 0.5s ease",o.style.transform="translateY(-320%)",o.style.opacity="0";var s=document.createElement("div"),e=(s.innerHTML=e,document.createElement("button")),l=(e.type="button",e.classList.add("btn"),e.classList.add("btn-close"),e.textContent=n.language[n.current_language].btn_confirm,e.addEventListener("click",n.deBounce(function(e){const t=e.target;o.style.transform="translateY(-320%)",o.style.transform="0",o.addEventListener("transitionend",function(){t.closest("div.iweb-alert-dialog").remove(),0===document.querySelectorAll("div.iweb-alert-dialog").length&&0===document.querySelectorAll("div.iweb-info-dialog").length&&document.body.classList.remove("iweb-disable-scroll"),"function"==typeof i&&i()},{once:!0})})),document.querySelector("div.iweb-viewer"));t.appendChild(o),o.appendChild(s),o.appendChild(e),a.appendChild(t),l.insertBefore(a,l.firstChild),document.body.classList.add("iweb-disable-scroll"),setTimeout(function(){n.showBusy(!1),o.style.transform="translateY(0)",o.style.opacity="1"},100)}else"function"==typeof i&&i()}}confirm(e,i,t){if(!(0<document.querySelectorAll("div.iweb-alert-dialog").length)){const o=this;if(o.isValue(e)){var a=document.createElement("div"),t=(a.classList.add("iweb-alert-dialog"),o.isValue(t)&&a.classList.add(t),document.createElement("div"));const r=document.createElement("div");r.classList.add("content"),r.style.transition="transform 0.5s ease, opacity 0.5s ease",r.style.transform="translateY(-320%)",r.style.opacity="0";var s=document.createElement("div"),e=(s.innerHTML=e,document.createElement("button")),l=(e.type="button",e.classList.add("btn"),e.classList.add("btn-yes"),e.textContent=o.language[o.current_language].btn_yes,e.addEventListener("click",o.deBounce(function(e){const t=e.target;r.style.transform="translateY(-320%)",r.style.transform="0",r.addEventListener("transitionend",function(){t.closest("div.iweb-alert-dialog").remove(),0===document.querySelectorAll("div.iweb-alert-dialog").length&&0===document.querySelectorAll("div.iweb-info-dialog").length&&document.body.classList.remove("iweb-disable-scroll"),"function"==typeof i&&i(!0)},{once:!0})})),document.createElement("button")),n=(l.type="button",l.classList.add("btn"),l.classList.add("btn-no"),l.textContent=o.language[o.current_language].btn_no,l.addEventListener("click",o.deBounce(function(e){const t=e.target;r.style.transform="translateY(-320%)",r.style.transform="0",r.addEventListener("transitionend",function(){t.closest("div.iweb-alert-dialog").remove(),0===document.querySelectorAll("div.iweb-alert-dialog").length&&0===document.querySelectorAll("div.iweb-info-dialog").length&&document.body.classList.remove("iweb-disable-scroll"),"function"==typeof i&&i(!1)},{once:!0})})),document.querySelector("div.iweb-viewer"));t.appendChild(r),r.appendChild(s),r.appendChild(e),r.appendChild(l),a.appendChild(t),n.insertBefore(a,n.firstChild),document.body.classList.add("iweb-disable-scroll"),setTimeout(function(){o.showBusy(!1),r.style.transform="translateY(0)",r.style.opacity="1"},100)}else"function"==typeof i&&i()}}dialog(e,t,i,a){if(!document.querySelector("div.iweb-info-dialog")){const o=this;if(o.isValue(e)){var s=document.createElement("div"),a=(s.classList.add("iweb-info-dialog"),o.isValue(a)&&s.classList.add(a),document.createElement("div"));const r=document.createElement("div");r.classList.add("content"),r.style.transition="transform 0.5s ease, opacity 0.5s ease",r.style.transform="translateY(-320%)",r.style.opacity="0";var l=document.createElement("div"),e=("string"==typeof e?l.insertAdjacentHTML("beforeend",e):l.appendChild(e),document.createElement("a")),n=(e.classList.add("btn"),e.classList.add("btn-close"),e.addEventListener("click",o.deBounce(function(e){const t=e.target;r.style.transform="translateY(-320%)",r.style.transform="0",r.addEventListener("transitionend",function(){t.closest("div.iweb-info-dialog").remove(),0===document.querySelectorAll("div.iweb-alert-dialog").length&&0===document.querySelectorAll("div.iweb-info-dialog").length&&document.body.classList.remove("iweb-disable-scroll"),"function"==typeof i&&i()},{once:!0})})),document.querySelector("div.iweb-viewer"));a.appendChild(r),r.appendChild(l),r.appendChild(e),s.appendChild(a),n.insertBefore(s,n.firstChild),document.body.classList.add("iweb-disable-scroll"),setTimeout(function(){o.showBusy(!1),o.initComponent(),o.initForm(),"function"==typeof t&&t(),r.style.transform="translateY(0)",r.style.opacity="1"},100)}}}modalDialog(e,t,i){this.isValue(e)&&(i=Object.assign({title:"",ClassName:"",width:0,height:0,init:t},i),this.isValue(i.ClassName)||(i.ClassName="default"),new iModalDialog(e,i))}tipsMsg(e,t=!1,i){var a,s,l,n;this.isValue(e)?(a=document.querySelector("div.iweb-tips-message"))?(s=Math.max(0,a.getAttribute("data-offset")||0),a.classList.remove("error"),a.classList.remove("success"),a.classList.add(t?"success":"error"),a.innerHTML="",t=document.createElement("div"),(l=document.createElement("a")).className="close",l.textContent="×",(n=document.createElement("span")).textContent=e,t.appendChild(l),t.appendChild(n),a.appendChild(t),this.scrollTo("div.iweb-tips-message",s),"function"==typeof i&&i()):this.alert(e,i):"function"==typeof i&&i()}bindEvent(e,t,i){const a=this;a.eventMap[e]||(a.eventMap[e]=[],document.addEventListener(e,function(i){a.eventMap[e].forEach(function(e){var t=i.target.closest(e.selector);t&&e.callBack(t,i)})})),a.eventMap[e].push({selector:t,callBack:i})}unBindEvent(e,t){this.eventMap[e]&&(this.eventMap[e]=this.eventMap[e].filter(e=>e.selector!==t),0===this.eventMap[e].length)&&delete this.eventMap[e]}triggerEvent(e,t){t=document.querySelector(t);t&&(e=new Event(e,{bubbles:!0,cancelable:!0}),t.dispatchEvent(e))}isValue(e){return null!=e&&(e instanceof HTMLElement?""!==e.outerHTML.trim():"object"==typeof e?Array.isArray(e)?0<e.length:0<Object.keys(e).length:""!==e.toString().trim())}isMatch(e,t,i=!1){return!(!this.isValue(e)||!this.isValue(t))&&(e=e.toString().trim(),t=t.toString().trim(),i?e===t:e.toLowerCase()===t.toLowerCase())}isNumber(e,t=!1){t=t?/^[0-9]+$/:/(^((-)?[1-9]{1}\d{0,2}|0\.|0$))(((\d)+)?)(((\.)(\d+))?)$/;return!!this.isValue(e)&&t.test(e)}isEmail(e){return!!this.isValue(e)&&/^([A-Za-z0-9_\-\.])+@([A-Za-z0-9_\-\.])+\.[A-Za-z]{2,}$/.test(e)}isPassword(e){return!!this.isValue(e)&&/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$/.test(e)}isDate(t,i="Y-m-d"){if(this.isValue(t)&&(this.isMatch(i,"Y-m-d")||(t=t.split("/").reverse().join("-")),/^(\d{4})(\-)(\d{2})(\-)(\d{2})$/.test(t))){let e=!0;var i=t.split("-"),a=parseInt(i[2]),s=parseInt(i[1]),i=parseInt(i[0]);return(isNaN(a)||isNaN(s)||isNaN(i)||i<=0||s<=0||12<s||a<=0||[1,3,5,7,8,10,12].includes(s)&&31<a||[4,6,9,11].includes(s)&&30<a||2==s&&((s=i%4==0&&i%100!=0||i%400==0)&&29<a||!s&&28<a))&&(e=!1),new Date(t)instanceof Date&&e}return!1}isTime(e){if(this.isValue(e)){var t,e=/^(\d{2}):(\d{2})$/.exec(e);if(e)return t=parseInt(e[1],10),e=parseInt(e[2],10),0<=t&&t<=23&&0<=e&&e<=59}return!1}toNumber(t,e,i=2,a=!0){if(t=t.toString().replace(/[^\d|\-|\.]/g,""),this.isNumber(t)){if(this.isNumber(i)&&0<parseInt(i)){var s=Math.pow(10,i);t*=s;let e=(t=(Math.round(t)/s).toString()).indexOf(".");for(e<0&&(e=t.length,t+=".");t.length<=e+i;)t+="0"}return a&&(t=(t=t.toString().replace(/(\.\d+?)0+$/g,"$1")).toString().replace(/(\.0)$/g,"")),this.isMatch(e,!0)?([s,a]=t.toString().split("."),e=s.replace(/(\d)(?=(\d{3})+$)/g,"$1,"),a?e+"."+a:e):t}return 0}toDateTime(e,t="Y-m-d H:i:s"){var e=this.isValue(e)?new Date(e):new Date,i=e.getFullYear();let a=e.getMonth()+1,s=e.getDate(),l=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),r=(1==a.toString().length&&(a="0"+a),1==s.toString().length&&(s="0"+s),1==l.toString().length&&(l="0"+l),1==n.toString().length&&(n="0"+n),1==o.toString().length&&(o="0"+o),"");switch(t){case"Y-m-d H:i:s":r=i+"-"+a+"-"+s+" "+l+":"+n+":"+o;break;case"Y-m-d H:i":r=i+"-"+a+"-"+s+" "+l+":"+n;break;case"d/m/Y H:i:s":r=s+"/"+a+"/"+i+" "+l+":"+n+":"+o;break;case"d/m/Y H:i":r=s+"/"+a+"/"+i+" "+l+":"+n;break;case"Y-m-d":r=i+"-"+a+"-"+s;break;case"d/m/Y":r=s+"/"+a+"/"+i;break;case"H:i:s":r=l+":"+n+":"+o;break;case"H:i":r=l+":"+n;break;case"Y":r=i;break;case"m":r=a;break;case"d":r=s;break;case"h":r=l;break;case"i":r=n;break;case"s":r=o}return r}setCookie(e,t,i=14){var a;navigator.cookieEnabled?this.isValue(e)&&((a=new Date).setTime(a.getTime()+24*i*60*60*1e3),i="expires="+a.toUTCString(),a=1<(a=window.location.pathname.split("/")).length&&""!==a[1]?"/"+a[1]+"/":"/",document.cookie=e+"="+t+";"+i+";path="+a):alert("Cookies Blocked or not supported by your browser.")}getCookie(e){if(navigator.cookieEnabled){if(this.isValue(e)){var t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){var a=i[e].trim();if(0===a.indexOf(t))return a.substring(t.length,a.length)}}}else alert("Cookies Blocked or not supported by your browser.");return""}deleteCookie(e){this.setCookie(e,"",-1)}deBounce(a,s=100,l=!0){let n;return function(e){l&&e&&"function"==typeof e.preventDefault&&e.preventDefault(),clearTimeout(n);const t=this,i=arguments;n=setTimeout(()=>a.apply(t,i),s)}}showBusy(t,i){if(this.isMatch(t,1)||this.isMatch(t,!0)){if(0===document.querySelectorAll("div.iweb-processing").length){let e=1;this.isNumber(i,!0)&&(e=Math.round(parseInt(i)/100*100)/100);var t=document.createElement("div"),a=(t.classList.add("iweb-processing"),0===parseFloat(e)?t.style.opacity=0:t.style.background="rgba(255, 255, 255, "+e+")",document.createElement("div")),s=(a.classList.add("loading"),document.createElementNS("http://www.w3.org/2000/svg","svg")),l=(s.setAttribute("width","48px"),s.setAttribute("height","48px"),s.setAttribute("viewBox","0 0 100 100"),s.setAttribute("preserveAspectRatio","xMidYMid"),document.createElementNS("http://www.w3.org/2000/svg","circle")),n=(l.setAttribute("cx","50"),l.setAttribute("cy","50"),l.setAttribute("fill","none"),l.setAttribute("stroke","#dddddd"),l.setAttribute("stroke-width","10"),l.setAttribute("r","36"),l.setAttribute("stroke-dasharray","169.64600329384882 58.548667764616276"),document.createElementNS("http://www.w3.org/2000/svg","animateTransform"));n.setAttribute("attributeName","transform"),n.setAttribute("type","rotate"),n.setAttribute("repeatCount","indefinite"),n.setAttribute("dur","1s"),n.setAttribute("values","0 50 50;360 50 50"),n.setAttribute("keyTimes","0;1"),l.appendChild(n),s.appendChild(l),a.appendChild(s),t.appendChild(a),document.body.insertBefore(t,document.body.firstChild)}}else{let e=0;this.isNumber(i,!0)&&(e=parseInt(i)),setTimeout(function(){document.querySelectorAll("div.iweb-processing").forEach(function(e){e.remove()})},e)}}scrollTo(e,t,i){e=document.querySelector(e);let a=0;e&&(t=this.isValue(t)?parseInt(t):80,a=Math.max(0,parseInt(e.getBoundingClientRect().top)+window.pageYOffset-t)),window.scrollTo({top:a,behavior:"smooth"}),setTimeout(function(){Math.abs(window.pageYOffset-a)<=1&&"function"==typeof i&&i()},100)}formatBytes(e,t){var i;return e?(t=t<0?0:t,i=Math.floor(Math.log(e)/Math.log(1024)),parseFloat((e/Math.pow(1024,i)).toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]):"0 Bytes"}getURL(e){return window.location.href.split("?")[0].toString()+(this.isValue(e)?"/"+e:"")}getURLParameter(t){let i="";if(this.isValue(t)){var a=window.location.search.substring(1).split("&");for(let e=0;e<parseInt(a.length);e++){var s=a[e].split("="),l=s[0],s=s[1];if(this.isValue(l)&&this.isValue(s)&&this.isMatch(l,t)){i=s;break}}}return i}randomNum(e,t){return(!this.isValue(e)||parseInt(e)<0)&&(e=0),(!this.isValue(t)||parseInt(t)<1)&&(t=1),e=parseInt(e),t=parseInt(t),parseInt(e)>parseInt(t)&&(e=0,t=1),parseInt(Math.random()*(t+1-e)+e)}randomString(t){var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";this.isNumber(t)||(t=12);let a="";for(let e=0;e<t;e++){var s=Math.floor(Math.random()*i.length);a+=i.substring(s,s+1)}return a}}class iMD5{constructor(){this.hex_chr="0123456789abcdef".split("")}add32(e,t){return e+t&4294967295}cmn(e,t,i,a,s,l){return this.add32(this.add32(this.add32(t,e),this.add32(a,l))<<s|this.add32(this.add32(t,e),this.add32(a,l))>>>32-s,i)}ff(e,t,i,a,s,l,n){return this.cmn(t&i|~t&a,e,t,s,l,n)}gg(e,t,i,a,s,l,n){return this.cmn(t&a|i&~a,e,t,s,l,n)}hh(e,t,i,a,s,l,n){return this.cmn(t^i^a,e,t,s,l,n)}ii(e,t,i,a,s,l,n){return this.cmn(i^(t|~a),e,t,s,l,n)}md5cycle(e,t){var i=e[0],i=this.ff(i,l=e[1],s=e[2],a=e[3],t[0],7,-680876936),a=this.ff(a,i,l,s,t[1],12,-389564586),s=this.ff(s,a,i,l,t[2],17,606105819),l=this.ff(l,s,a,i,t[3],22,-1044525330);i=this.ff(i,l,s,a,t[4],7,-176418897),a=this.ff(a,i,l,s,t[5],12,1200080426),s=this.ff(s,a,i,l,t[6],17,-1473231341),l=this.ff(l,s,a,i,t[7],22,-45705983),i=this.ff(i,l,s,a,t[8],7,1770035416),a=this.ff(a,i,l,s,t[9],12,-1958414417),s=this.ff(s,a,i,l,t[10],17,-42063),l=this.ff(l,s,a,i,t[11],22,-1990404162),i=this.ff(i,l,s,a,t[12],7,1804603682),a=this.ff(a,i,l,s,t[13],12,-40341101),s=this.ff(s,a,i,l,t[14],17,-1502002290),l=this.ff(l,s,a,i,t[15],22,1236535329),i=this.gg(i,l,s,a,t[1],5,-165796510),a=this.gg(a,i,l,s,t[6],9,-1069501632),s=this.gg(s,a,i,l,t[11],14,643717713),l=this.gg(l,s,a,i,t[0],20,-373897302),i=this.gg(i,l,s,a,t[5],5,-701558691),a=this.gg(a,i,l,s,t[10],9,38016083),s=this.gg(s,a,i,l,t[15],14,-660478335),l=this.gg(l,s,a,i,t[4],20,-405537848),i=this.gg(i,l,s,a,t[9],5,568446438),a=this.gg(a,i,l,s,t[14],9,-1019803690),s=this.gg(s,a,i,l,t[3],14,-187363961),l=this.gg(l,s,a,i,t[8],20,1163531501),i=this.gg(i,l,s,a,t[13],5,-1444681467),a=this.gg(a,i,l,s,t[2],9,-51403784),s=this.gg(s,a,i,l,t[7],14,1735328473),l=this.gg(l,s,a,i,t[12],20,-1926607734),i=this.hh(i,l,s,a,t[5],4,-378558),a=this.hh(a,i,l,s,t[8],11,-2022574463),s=this.hh(s,a,i,l,t[11],16,1839030562),l=this.hh(l,s,a,i,t[14],23,-35309556),i=this.hh(i,l,s,a,t[1],4,-1530992060),a=this.hh(a,i,l,s,t[4],11,1272893353),s=this.hh(s,a,i,l,t[7],16,-155497632),l=this.hh(l,s,a,i,t[10],23,-1094730640),i=this.hh(i,l,s,a,t[13],4,681279174),a=this.hh(a,i,l,s,t[0],11,-358537222),s=this.hh(s,a,i,l,t[3],16,-722521979),l=this.hh(l,s,a,i,t[6],23,76029189),i=this.hh(i,l,s,a,t[9],4,-640364487),a=this.hh(a,i,l,s,t[12],11,-421815835),s=this.hh(s,a,i,l,t[15],16,530742520),l=this.hh(l,s,a,i,t[2],23,-995338651),i=this.ii(i,l,s,a,t[0],6,-198630844),a=this.ii(a,i,l,s,t[7],10,1126891415),s=this.ii(s,a,i,l,t[14],15,-1416354905),l=this.ii(l,s,a,i,t[5],21,-57434055),i=this.ii(i,l,s,a,t[12],6,1700485571),a=this.ii(a,i,l,s,t[3],10,-1894986606),s=this.ii(s,a,i,l,t[10],15,-1051523),l=this.ii(l,s,a,i,t[1],21,-2054922799),i=this.ii(i,l,s,a,t[8],6,1873313359),a=this.ii(a,i,l,s,t[15],10,-30611744),s=this.ii(s,a,i,l,t[6],15,-1560198380),l=this.ii(l,s,a,i,t[13],21,1309151649),i=this.ii(i,l,s,a,t[4],6,-145523070),a=this.ii(a,i,l,s,t[11],10,-1120210379),s=this.ii(s,a,i,l,t[2],15,718787259),l=this.ii(l,s,a,i,t[9],21,-343485551),e[0]=this.add32(i,e[0]),e[1]=this.add32(l,e[1]),e[2]=this.add32(s,e[2]),e[3]=this.add32(a,e[3])}md51(e){var t=e.length,i=[1732584193,-271733879,-1732584194,271733878];let a;for(a=64;a<=e.length;a+=64)this.md5cycle(i,this.md5blk(e.substring(a-64,a)));e=e.substring(a-64);let s=new Array(16).fill(0);for(a=0;a<e.length;a++)s[a>>2]|=e.charCodeAt(a)<<(a%4<<3);return s[a>>2]|=128<<(a%4<<3),55<a&&(this.md5cycle(i,s),s=new Array(16).fill(0)),s[14]=8*t,this.md5cycle(i,s),i}md5blk(t){var i=[];for(let e=0;e<64;e+=4)i[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return i}rhex(t){let i="";for(let e=0;e<4;e++)i+=this.hex_chr[t>>8*e+4&15]+this.hex_chr[t>>8*e&15];return i}hex(t){for(let e=0;e<t.length;e++)t[e]=this.rhex(t[e]);return t.join("")}hash(e){return this.hex(this.md51(e))}}class iDatePicker{constructor(e="en",t="YYYY-MM-DD"){this.lang=e,this.dateFormat=t,this.calendarElement,this.currentDate=new Date,this.selectedDate,this.minDate,this.maxDate,this.activeInputElement,document.addEventListener("click",e=>{!this.calendarElement||e.target.closest("input.idatepicker")||e.target.closest("div.idatepicker-calendar")||"idatepicker-prev-month"===e.target.id||"idatepicker-next-month"===e.target.id?e.target.closest("input.idatepicker")&&this.onFocusInput(e.target):this.hideCalendar()})}render(e){e=document.querySelectorAll(e);e&&e.forEach(e=>{e.classList.contains("idatepicker")||(e.type="text",e.classList.add("idatepicker"))})}onFocusInput(e){let t=e.value;t&&this.isValidDateFormat(t)||(t=this.formatDate(new Date)),this.currentDate=this.parseDate(t),this.selectedDate=new Date(this.currentDate),this.minDate=e.getAttribute("data-min")?.trim()||null,this.maxDate=e.getAttribute("data-max")?.trim()||null,this.activeInputElement=e,this.showCalendar(e)}showCalendar(e){this.calendarElement&&this.calendarElement.remove(),this.calendarElement=this.createElement("div",{position:"absolute",backgroundColor:"#fff",fontSize:"12px",padding:"8px",border:"2px solid #e6e6e6",borderRadius:"4px",boxSizing:"border-box",marginTop:"2px",zIndex:"100"},"idatepicker-calendar"),document.body.appendChild(this.calendarElement);e=e.getBoundingClientRect();this.calendarElement.style.top=e.bottom+window.scrollY+"px",this.calendarElement.style.left=e.left+window.scrollX+"px",this.buildCalendar()}hideCalendar(){this.calendarElement&&(this.calendarElement.remove(),this.calendarElement)}buildCalendar(){var e=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),i=(this.calendarElement.innerHTML="",this.createHeader()),e=this.createCalendarTable(e,t);this.calendarElement.appendChild(i),this.calendarElement.appendChild(e)}createHeader(){var e=this.createElement("div",{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"5px 0px 10px 0px"}),t=this.createButton("🞀","idatepicker-prev-month",()=>this.changeMonth(-1)),i=this.createElement("span",{fontSize:"15px",fontWeight:"bold"}),a=(i.textContent=this.currentDate.toLocaleString("en"===this.lang?"en":"zh",{month:"short"})+" / "+this.currentDate.getFullYear(),this.createButton("🞂","idatepicker-next-month",()=>this.changeMonth(1)));return e.appendChild(t),e.appendChild(i),e.appendChild(a),e}createButton(e,t,i){var a=this.createElement("button",{position:"relative",backgroundColor:"#2ca4e9",fontSize:"12px",color:"#fff",padding:"3px 6px",border:"none",borderRadius:"3px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",boxSizing:"border-box",cursor:"pointer"});return a.type="button",a.id=t,a.textContent=e,a.addEventListener("click",e=>{e.preventDefault(),i()}),a}changeMonth(e){this.currentDate.setMonth(this.currentDate.getMonth()+e),this.buildCalendar()}createCalendarTable(e,t){var i=this.createElement("table",{width:"100%",borderCollapse:"collapse"}),a=this.createTableHeader(),e=this.createTableBody(e,t);return i.appendChild(a),i.appendChild(e),i}createTableHeader(){var e=document.createElement("thead");const i=document.createElement("tr");return("en"===this.lang?["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]:["日","一","二","三","四","五","六"]).forEach(e=>{var t=this.createElement("th",{width:"36px",height:"28px",fontSize:"12px",color:"#2ca4e9",padding:"4px",border:"2px solid #e6e6e6",boxSizing:"border-box",textAlign:"center"});t.textContent=e,i.appendChild(t)}),e.appendChild(i),e}createTableBody(a,s){var e=document.createElement("tbody"),l=new Date(a,s,1).getDay(),n=new Date(a,s+1,0).getDate();let o=new Date(a,s,0).getDate()-l+1,r=1,d=1;for(let i=0;i<6;i++){var c,u,p=document.createElement("tr");for(let t=0;t<7;t++){let e;e=0===i&&t<l?(c=this.formatDate(new Date(a,s-1,o++)),this.createDateCell(o-1,c,!0)):r>n?(c=this.formatDate(new Date(a,s+1,d)),this.createDateCell(d++,c,!0)):(u=this.formatDate(new Date(a,s,r)),this.createDateCell(r++,u,!1)),p.appendChild(e)}e.appendChild(p)}return e}createDateCell(e,t,i){let a=!0;null!==this.minDate&&0<new Date(this.minDate)-new Date(t)&&(a=!1),null!==this.maxDate&&new Date(this.maxDate)-new Date(t)<0&&(a=!1);i=this.createElement("td",{backgroundColor:this.selectedDate&&t===this.formatDate(this.selectedDate)?"#2ca4e9":"",width:"36px",height:"28px",fontSize:"12px",color:!a||i?"#aaa":this.selectedDate&&t===this.formatDate(this.selectedDate)?"#fff":"",padding:"4px",border:"2px solid #e6e6e6",boxSizing:"border-box",textAlign:"center",cursor:"pointer"});return i.dataset.date=t,i.textContent=e,a&&i.addEventListener("click",()=>this.onDateSelect(t)),i}onDateSelect(e){e=this.parseDate(e);isNaN(e)||(this.activeInputElement.value=this.formatDate(e),this.activeInputElement.dispatchEvent(new Event("change",{bubbles:!0})),this.selectedDate=e,this.buildCalendar(),this.hideCalendar())}createElement(e,t={},i){e=document.createElement(e);return i&&(e.className=i),Object.assign(e.style,t),e}isValidDateFormat(e){let t;return(t="DD/MM/YYYY"===this.dateFormat.toString().toUpperCase()?/^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/\d{4}$/:/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/).test(e)}parseDate(e){var[e,t,i]="DD/MM/YYYY"===this.dateFormat.toString().toUpperCase()?e.split("/").map(Number).reverse():e.split("-").map(Number);return new Date(e,t-1,i)}formatDate(e){var t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),e=String(e.getDate()).padStart(2,"0");return"DD/MM/YYYY"===this.dateFormat.toString().toLowerCase()?e+"/"+i+"/"+t:t+"-"+i+"-"+e}}class iTimePicker{constructor(){this.activeInput=null,document.addEventListener("click",e=>{e.target.closest("input.itimepicker")||e.target.closest("div.time-picker-list")?e.target.closest("input.itimepicker")&&(this.showTimePicker(e.target),this.formatInputTime(e.target)):this.hidePicker()})}render(e){e=document.querySelectorAll(e);e&&e.forEach(e=>{e.classList.contains("itimepicker")||(e.type="text",e.classList.add("itimepicker"))})}showTimePicker(e){this.hidePicker(),this.activeInput=e;var t=parseInt(e.getAttribute("data-start"))||800,i=parseInt(e.getAttribute("data-end"))||2200,a=parseInt(e.getAttribute("data-interval"))||5,t=this.createPicker(t,i,a),{top:i,left:a,height:e}=(document.body.appendChild(t),e.getBoundingClientRect());t.style.position="absolute",t.style.top=i+window.scrollY+e+"px",t.style.left=a+window.scrollX+"px",t.addEventListener("click",e=>{e.target.classList.contains("time-option")&&(this.activeInput.value=e.target.textContent,this.activeInput.dispatchEvent(new Event("change",{bubbles:!0})),this.hidePicker())})}hidePicker(){var e=document.querySelector("div.time-picker-list");e&&e.remove()}createPicker(e,t,i){const a=document.createElement("div");return a.classList.add("time-picker-list"),a.style.border="2px solid #e6e6e6",a.style.backgroundColor="#fff",a.style.padding="10px",a.style.marginTop="2px",a.style.maxHeight="200px",a.style.overflow="auto",a.style.zIndex="100",this.generateTimeOptions(e,t,i).forEach(e=>{var t=document.createElement("div");t.textContent=e,t.classList.add("time-option"),t.style.padding="5px",t.style.cursor="pointer",t.style.borderBottom="1px solid #f0f0f0",a.appendChild(t)}),a}generateTimeOptions(e,t,i){var a=[],s=Math.floor(e/100),e=e%100,l=Math.floor(t/100),n=t%100;let o=s,r=e;for(;o<l||o===l&&r<=n;)parseInt(o)<24&&a.push(this.formatTime(o,r)),60<=(r+=i)&&(r=0,o++);return a}formatTime(e,t){return String(e).padStart(2,"0")+":"+String(t).padStart(2,"0")}formatInputTime(e){var t,i=e.value.replace(/\D/g,"");4<i.length||4===i.length&&(t=i.slice(0,2),i=i.slice(2,4),e.value=this.formatTime(parseInt(t),parseInt(i)))}}class iPagination{constructor(e,t){this.options=Object.assign({mode:1,size:5,total:1,placeholder:""},t),this.currentPage=1,this.url=new URL(window.location.href),this.searchParams=new URLSearchParams(this.url.search),this.searchParams.has("page")&&(this.currentPage=Math.max(parseInt(this.searchParams.get("page")),1)),this.searchParams.delete("page"),this.baseUrl=this.url.origin+this.url.pathname+"?"+this.searchParams.toString(),this.renderPagination(e)}createPageUrl(e){return(this.baseUrl+"&page="+e).replace("?&","?")}jumpToPage(t){t.addEventListener("keypress",e=>{13===e.which&&(e=Math.min(Math.max(parseInt(t.value)||1,1),t.getAttribute("data-max")),window.location.href=this.createPageUrl(e))})}createPaginationElement(e,t="",i=""){e=document.createElement(e);return t&&(e.className=t),i&&(e.innerHTML=i),e}renderPagination(e){if(!e.querySelector(".iweb-pagination")){var a=e.getAttribute("data-size")||this.options.size,s=e.getAttribute("data-totalpage")||this.options.total,l=Math.max(this.currentPage-1,1),n=Math.min(this.currentPage+1,s),o=s,r=Math.floor(a/2);let t=Math.max(this.currentPage-r,1),i=Math.min(this.currentPage+r,o);if(i-t+1<a&&(this.currentPage<1+r?i=Math.min(o,t+a-1):t=Math.max(1,i-a+1)),1<s){var a=this.createPaginationElement("div","iweb-pagination"),d=this.createPaginationElement("ul"),c=this.createPaginationElement("a","first",2===this.options.mode&&this.currentPage>r?"<span>1..</span>":"<i></i><i></i>"),u=(c.href=this.createPageUrl(1),c.title="First Page",this.createPaginationElement("li")),c=(u.appendChild(c),d.appendChild(u),this.createPaginationElement("a","prev","<i></i>")),u=(c.href=this.createPageUrl(l),c.title="Previous Page",this.createPaginationElement("li"));u.appendChild(c),d.appendChild(u);for(let e=t;e<=i;e++){var p=this.createPaginationElement("a","num"+(e===this.currentPage?" current":""),"<span>"+e+"</span>"),h=(p.href=this.createPageUrl(e),this.createPaginationElement("li"));h.appendChild(p),d.appendChild(h)}l=this.createPaginationElement("a","next","<i></i>"),c=(l.href=this.createPageUrl(n),l.title="Next Page",this.createPaginationElement("li")),u=(c.appendChild(l),d.appendChild(c),this.createPaginationElement("a","last",2===this.options.mode&&this.currentPage<s-r?"<span>.."+o+"</span>":"<i></i><i></i>")),n=(u.href=this.createPageUrl(o),u.title="Last Page",this.createPaginationElement("li")),l=(n.appendChild(u),d.appendChild(n),this.createPaginationElement("li")),c=this.createPaginationElement("input","jumpto_page");c.type="text",c.placeholder=this.options.placeholder,c.setAttribute("data-max",s),this.jumpToPage(c),l.appendChild(c),d.appendChild(l),a.appendChild(d),e.appendChild(a)}}}}class iModalDialog{constructor(e="",t){this.options=Object.assign({title:"",width:0,height:0,className:"default",init:null},t),this.createModal(e),this.makeDraggable(),this.makeResizable(),this.makeMaximizable()}createModal(e){this.modal=document.createElement("div"),this.modal.classList.add("imodal-dialog"),this.modal.classList.add(this.options.className),0<this.options.width&&0<this.options.height&&(this.modal.style.width=this.options.width+"px",this.modal.style.height=this.options.height+"px");var t=document.createElement("div"),i=(t.classList.add("top"),document.createElement("span")),a=(i.classList.add("title"),i.textContent=this.options.title,document.createElement("div")),s=(a.classList.add("actions"),document.createElement("button")),l=(s.classList.add("fullscreen"),document.createElement("i")),l=(l.classList.add("fa","fa-clone"),s.appendChild(l),document.createElement("button")),n=(l.classList.add("close"),document.createElement("i")),n=(n.classList.add("fa","fa-times"),l.appendChild(n),a.appendChild(s),a.appendChild(l),t.appendChild(i),t.appendChild(a),document.createElement("div")),s=(n.classList.add("content"),n.innerHTML=e,document.createElement("div"));s.classList.add("resize-handle"),this.modal.appendChild(t),this.modal.appendChild(n),this.modal.appendChild(s),document.body.appendChild(this.modal),this.modal.style.left=(document.documentElement.clientWidth-this.modal.offsetWidth)/2+(100*Math.random()-50)+"px",this.modal.style.top=(document.documentElement.clientHeight-this.modal.offsetHeight)/2+(100*Math.random()-50)+"px",this.modal.querySelector("button.close").addEventListener("click",()=>this.close()),this.modal.querySelector("button.fullscreen").addEventListener("click",()=>this.toggleMaximize()),this.bringToFront(),this.modal.addEventListener("mousedown",()=>this.bringToFront()),"function"==typeof this.options.init&&this.options.init()}bringToFront(){let t=200;document.querySelectorAll("div.imodal-dialog").forEach(e=>{e=parseInt(window.getComputedStyle(e).zIndex,10);isNaN(e)||(t=Math.max(t,e))}),this.modal.style.zIndex=t+1}makeDraggable(){let a,s,t=!1;this.modal.querySelector("div.top").addEventListener("mousedown",e=>{t=!0,a=e.clientX-this.modal.offsetLeft,s=e.clientY-this.modal.offsetTop,this.bringToFront()});document.addEventListener("mousemove",i=>{if(t){let e=i.clientX-a,t=i.clientY-s;e=Math.max(0,Math.min(e,document.documentElement.clientWidth-this.modal.offsetWidth)),t=Math.max(0,Math.min(t,document.documentElement.clientHeight-this.modal.offsetHeight)),requestAnimationFrame(()=>{this.modal.style.left=e+"px",this.modal.style.top=t+"px"})}}),document.addEventListener("mouseup",()=>t=!1)}makeResizable(){let t=!1,a,s,l,n;this.modal.querySelector("div.resize-handle").addEventListener("mousedown",e=>{t=!0,a=e.clientX,s=e.clientY,l=this.modal.offsetWidth,n=this.modal.offsetHeight,this.bringToFront()});document.addEventListener("mousemove",i=>{if(t){let e=l+(i.clientX-a),t=n+(i.clientY-s);e=Math.max(200,Math.min(e,document.documentElement.clientWidth-this.modal.offsetLeft)),t=Math.max(150,Math.min(t,document.documentElement.clientHeight-this.modal.offsetTop)),requestAnimationFrame(()=>{this.modal.style.width=e+"px",this.modal.style.height=t+"px"})}}),document.addEventListener("mouseup",()=>t=!1)}makeMaximizable(){this.isMaximized=!1,this.normalState={width:"",height:"",left:"",top:""},this.toggleMaximize=()=>{this.isMaximized?(this.modal.style.width=this.normalState.width,this.modal.style.height=this.normalState.height,this.modal.style.left=this.normalState.left,this.modal.style.top=this.normalState.top):(this.normalState={width:this.modal.style.width,height:this.modal.style.height,left:this.modal.style.left,top:this.modal.style.top},this.modal.style.width=document.documentElement.clientWidth+"px",this.modal.style.height=document.documentElement.clientHeight+"px",this.modal.style.left="0px",this.modal.style.top="0px"),this.isMaximized=!this.isMaximized}}close(){this.modal.remove()}}